<IfDefine !DEFAULT>
<IfDefine PROXYDEFAULT>
<VirtualHost _default_:80>
    ServerName ${APACHE_SERVER_NAME}
    ServerAdmin ${APACHE_SERVER_ADMIN}
    DocumentRoot /var/www/html
    <Directory /var/www/html>
        AllowOverride All
    </Directory>

    # For most configuration files from conf-available/, which are
    # enabled or disabled at a global level, it is possible to
    # include a line for only one particular virtual host. For example the
    # following line enables the CGI configuration for this host only
    # after it has been globally disabled with "a2disconf".
    #Include conf-available/serve-cgi-bin.conf

    <IfModule mod_ssl.c>
        SSLProxyEngine on
    </IfModule>
    ProxyPreserveHost ${APACHE_PROXY_PRESERVE_HOST}
    ProxyPass / "${APACHE_PROXY_URL}" retry=0 disablereuse=on
    ProxyPassReverse / "${APACHE_PROXY_URL}"

    <IfDefine SSI>
        Options +IncludesNOEXEC
        AddOutputFilter INCLUDES .shtml .html
        AddOutputFilterByType INCLUDES text/html
    </IfDefine>

    <IfDefine CACHE>
        Use pie_cache ${APACHE_CACHE_DEFAULT} ${APACHE_CACHE_MIN} ${APACHE_CACHE_MAX}
        CacheKeyBaseURL "${APACHE_PROXY_URL}"

        CacheEnable disk /
        <IfDefine SSI>
            AddOutputFilter INCLUDES;CACHE .shtml .html
            AddOutputFilterByType INCLUDES;CACHE text/html
        </IfDefine>
    </IfDefine>

    <IfModule mod_shib.cpp>
        <Location />
            ShibUseHeaders on
        </Location>

        # Make sure /Shibboleth.sso is always handled by mod_shib
        <Location /Shibboleth.sso>
            Require all granted
            SetHandler shib
        </Location>

        Alias /shibboleth-sp/ /usr/share/shibboleth/
        <Directory /usr/share/shibboleth/>
            Require all granted
        </Directory>
    </IfModule>
</VirtualHost>
</IfDefine>
</IfDefine>

# vim: syntax=apache ts=4 sw=4 sts=4 et sr noet
